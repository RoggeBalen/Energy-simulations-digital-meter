---
title: "Energie simulaties voor digitale meter"
output:
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: scroll
    css: styles.css
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.align = "center" , out.width = "100%")
eval_option = F
```


```{r include=FALSE}
### Load necessary libraries
#---------------------------
library(tidyverse)
library(lubridate)
library(ggplot2)
library(plotly)
library(plyr)
library(flexdashboard)
library(DT)


### Load functions
#-----------------
source("~/Energy-simulations-digital-meter/src/energycost/energy_cost_ecopower.R")
source("~/Energy-simulations-digital-meter/src/energyviz/Function_viz_afname_inname.R")
source("~/Energy-simulations-digital-meter/src/energyviz/Function_viz_kostprijs.R")
source("~/Energy-simulations-digital-meter/src/energyviz/Function_viz_batt_cap.R")
source("~/Energy-simulations-digital-meter/src/batterysim/Home_battery_simulation.R")
source("~/Energy-simulations-digital-meter/src/dataformat/Change_data_format.R")
```


# Algemene informatie

###

Dit dashboard is ontworpen om **energieprijzen** en **batterijcapaciteiten** te vergelijken. <br>
Dit helpt bij het evalueren van:

- Tarieven van verschillende energieleveranciers
- Opslagcapaciteit van batterijen en hun impact op kostenbesparing
- Optimalisatie van verbruik op basis van dynamische prijsmodellen


---


Hoe dit dashboard te gebruiken?

- De tab `Data visualisatie` visualiseert historische data op basis van de digitale meter.
- De tab `Simulatie` bevat simulaties van de mogelijke kostprijs onder verschillende scenarios. <br>
Deze worden bepaald door het type tarief en eventueel het type batterij.


---


**Laatste update:** `r Sys.Date()`


- Versie 1.0 &nbsp; &nbsp; - &nbsp;&nbsp;31/12/2025:&nbsp;&nbsp; Test versie met dummy data.



# Rogge {data-navmenu="Data visualisatie"}

###

```{r echo=FALSE, message=FALSE, warning=FALSE}
### Load data
#------------
Test_31122025_rogge <- read.csv2("~/Energy-simulations-digital-meter/data/Test_31122025.csv")


### Change format
#----------------
df_rogge <- Change_data_format(Test_31122025_rogge , tz = "Europe/Brussels")
```


**Historische data - Roggestraat**

---

Voordat we starten met de simulaties, bekijken we eerst de historische gegevens die als basis dienen voor onze analyses. De data is afkomstig van **Fluvius digitale meters** en heeft een **resolutie van 15 minuten** (kwartierwaarden). Deze dataset bevat gedetailleerde informatie over het **energieverbruik** en **injectie** op huishoudniveau. De data loopt van `r min(df_rogge$start_time)` tot `r max(df_rogge$end_time)`, en vormt het referentiepunt voor het vergelijken van toekomstige scenario’s.


### 

**Verbruik en injectie per kwartier**

---

```{r}
plot_week_switch(df_rogge)
```

###

De bovenstaande grafiek toont de **tijd** (x-as) ten opzichte van **verbruik** (y-as) en **injectie** (y-as). Je kunt er interactief mee spelen:

- **Zoomen**  
  - Scroll met je muis om in of uit te zoomen.  
  - Klik en sleep om een specifiek gebied te selecteren.  
  - Dubbelklik om terug te keren naar de oorspronkelijke schaal.

- **Hover voor details**  
  - Beweeg je muis over de lijnen om exacte waarden (tijd en kWh) te zien.

- **Legenda gebruiken**  
  - Klik op een item in de legenda om die lijn te verbergen of weer te tonen.  
  - Dubbelklik op een item om alleen die lijn te tonen.

- **Knoppen voor tijdsperiode**  
  - Gebruik de knoppen bovenaan om snel een periode te kiezen:  
    `Laatste 3 maanden`, `Laatste maand`, `Laatste week`, of `Alles`.


# Leo {data-navmenu="Data visualisatie"}

###

```{r echo=FALSE, message=FALSE, warning=FALSE}
### Load data
#------------
Leo <- read.csv2("~/Energy-simulations-digital-meter/data/Leo_03012026.csv")


### Change format
#----------------
df_leo <- Change_data_format(Leo , tz = "Europe/Brussels")
```


**Historische data - Leo**

---

Voordat we starten met de simulaties, bekijken we eerst de historische gegevens die als basis dienen voor onze analyses. De data is afkomstig van **Fluvius digitale meters** en heeft een **resolutie van 15 minuten** (kwartierwaarden). Deze dataset bevat gedetailleerde informatie over het **energieverbruik** en **injectie** op huishoudniveau. De data loopt van `r min(df_leo$start_time)` tot `r max(df_leo$end_time)`, en vormt het referentiepunt voor het vergelijken van toekomstige scenario’s.


### 

**Verbruik en injectie per kwartier**

---

```{r}
plot_week_switch(df_leo)
```

###

De bovenstaande grafiek toont de **tijd** (x-as) ten opzichte van **verbruik** (y-as) en **injectie** (y-as). Je kunt er interactief mee spelen:

- **Zoomen**  
  - Scroll met je muis om in of uit te zoomen.  
  - Klik en sleep om een specifiek gebied te selecteren.  
  - Dubbelklik om terug te keren naar de oorspronkelijke schaal.

- **Hover voor details**  
  - Beweeg je muis over de lijnen om exacte waarden (tijd en kWh) te zien.

- **Legenda gebruiken**  
  - Klik op een item in de legenda om die lijn te verbergen of weer te tonen.  
  - Dubbelklik op een item om alleen die lijn te tonen.

- **Knoppen voor tijdsperiode**  
  - Gebruik de knoppen bovenaan om snel een periode te kiezen:  
    `Laatste 3 maanden`, `Laatste maand`, `Laatste week`, of `Alles`.






# Rogge {data-navmenu="Simulaties"}

### 

**Evolutie van energiekosten per batterijconfiguratie**
 
---

```{r}
### Do the calculations
#----------------------
out <- rbind(
  simulate_battery(df_rogge, batt_cap = 0, tarief = "Vast tarief ecopower Kempen", energie_kost = energy_cost_ecopower),
  simulate_battery(df_rogge, batt_cap = 5, tarief = "Vast tarief ecopower Kempen", energie_kost = energy_cost_ecopower),
  simulate_battery(df_rogge, batt_cap = 7.5, tarief = "Vast tarief ecopower Kempen", energie_kost = energy_cost_ecopower),
  simulate_battery(df_rogge, batt_cap = 10, tarief = "Vast tarief ecopower Kempen", energie_kost = energy_cost_ecopower)
             )


### Make the plot
#----------------
plot_week_switch_batt(out , tz_display = "Europe/Brussels")
```



###

**Batterij capaciteit**

```{r}
### Make the plot
#----------------
plot_week_switch_batt_cap(out , tz_display = "Europe/Brussels")
```


# Leo {data-navmenu="Simulaties"}

### 

**Evolutie van energiekosten per batterijconfiguratie**
 
---

```{r}
### Do the calculations
#----------------------
out_leo <- rbind(
  simulate_battery(df_leo, batt_cap = 0, tarief = "Vast tarief ecopower Kempen", energie_kost = energy_cost_ecopower),
  simulate_battery(df_leo, batt_cap = 5, tarief = "Vast tarief ecopower Kempen", energie_kost = energy_cost_ecopower),
  simulate_battery(df_leo, batt_cap = 7.5, tarief = "Vast tarief ecopower Kempen", energie_kost = energy_cost_ecopower),
  simulate_battery(df_leo, batt_cap = 10, tarief = "Vast tarief ecopower Kempen", energie_kost = energy_cost_ecopower)
             )


### Make the plot
#----------------
plot_week_switch_batt(out_leo , tz_display = "Europe/Brussels")
```



###

**Batterij capaciteit**

```{r}
### Make the plot
#----------------
plot_week_switch_batt_cap(out_leo , tz_display = "Europe/Brussels")
```






# Uitleg simulaties

###

**Redenering achter de simulatie studie**

---

**1) Context en doel**

Deze berekening vormt de basis van de simulaties. <br>
Het doel is om de energiekost per tijdsinterval te bepalen, rekening houdend met:

- Netto-afname van het net
- Tariefstructuur (bv. vast, variabel of dinamisch tarief)
- Injectie via zonnepanelen
- Eventuele batterijlogica (laden/ontladen)


**2) Netto-effect en tekens**

- Verbruik > Injectie &nbsp; &nbsp; → &nbsp; &nbsp; positieve kost (netto afname).
- Injectie > Verbruik &nbsp; &nbsp; → &nbsp; &nbsp; negatieve kost (credit).
- Gelijk &nbsp; &nbsp; → &nbsp; &nbsp; kost = 0.


**3) Formule per tijdsinterval**

De energiekost wordt berekend met:

\[
\text{Kostprijs}_{t} = \big(\text{Verbruik}_{t} - \text{Injectie}_{t}\big) \times \text{Tarief}_{t}
\]

Definities:

- \(\text{Verbruik}_{t}\):&nbsp; &nbsp; elektriciteit afgenomen van het net (kWh).
- \(\text{Injectie}_{t}\):&nbsp; &nbsp; elektriciteit teruggeleverd aan het net (kWh).
- \(\text{Tarief}_{t}\):&nbsp; &nbsp; prijs per kWh (€, bv. Vast tarief). 

Zie hieronder de desbetreffende functie die gebruikt wordt voor de berekeningen.

```{r}
code <- readLines("~/Energy-simulations-digital-meter/src/energycost/energy_cost_ecopower.R")
knitr::asis_output(paste0("```r\n", paste(code, collapse = "\n"), "\n```"))
```



**4) Batterijlogica**

De batterij beïnvloedt de netto-afname:

- Laden bij overschot &nbsp; &nbsp; → &nbsp; &nbsp; minder injectie naar het net.
- Ontladen bij tekort &nbsp; &nbsp; → &nbsp; &nbsp; minder verbruik van het net.


Hieronder is de functie gegeven om de invloed van een batterij mee in rekening te nemen.

```{r}
code <- readLines("~/Energy-simulations-digital-meter/src/batterysim/Home_battery_simulation.R")
knitr::asis_output(paste0("```r\n", paste(code, collapse = "\n"), "\n```"))
```



**5) Totale kost over een periode**

Sommeer alle intervalkosten:

\[
\text{Totale kost} = \sum_{t \in \text{periode}} \text{Kostprijs}_{t}
\]


**6) Aannames**

- Intervalduur: &nbsp; 15 minuten.
- Tarief: &nbsp; lineair per kWh (geen vaste kosten).
- Negatieve kost bij injectie = credit.
- Batterijrendement niet gemodelleerd.




